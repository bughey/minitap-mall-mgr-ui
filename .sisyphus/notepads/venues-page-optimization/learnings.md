# venues-page-optimization learnings

- 2026-01-22: Added venue pagination types (`PlacePageItem`, `PlacePageResponse`) and API client methods (`placeApi.page`, `placeApi.getStats`) using existing URLSearchParams + trim conventions from `placeGiftApi.page`.
- 2026-01-22: Documented new endpoints `/api/v1/place/page` and `/api/v1/place/stats` in `README.md`, including query parameters and example responses. Marked `/api/v1/place/list` as legacy for large venue lists (1000+).
- 2026-01-22: Verified that the new API contracts in `README.md` match the implementation requirements (paged response shape, `group_count` field, exclusion of `groups[]`).
- 2026-01-22: Added a prominent note under "场地管理页面" to recommend `/api/v1/place/page` + `/api/v1/place/stats` for 1000+ venues and to reiterate `/api/v1/place/list` as legacy/full list.
- 2026-01-22 20:27:16 +0800: Refactored `src/components/pages/VenuesPage.tsx` to fetch venues via `placeApi.page({ page, page_size, search })` and stats via `placeApi.getStats()`, with separate `loadingList/loadingStats` + `errorList/errorStats` for partial rendering. Implemented list race-safety using a `useRef` request id counter (only the latest request updates state), and decoupled `searchInput` from the applied `search` query to avoid request storms.
- 2026-01-22 20:32:56 +0800: Moved the global "场地统计" summary into a top KPI card grid (Overview-style: shadow + icon pill + bottom accent bar), with skeleton loading and a non-blocking inline failure message.
- 2026-01-22 20:39:44 +0800: Implemented a dense md+ table view in `src/components/pages/VenuesPage.tsx` using `src/components/ui/table.tsx` (skeleton rows + empty state), while keeping mobile cards and ensuring table/cards are mutually exclusive via `hidden md:block` + `md:hidden`. Group count is a button hook stub (no per-row fetching); agent/actions use existing handlers.
- 2026-01-22 21:00:00 +0800: Simplified the mobile-only (`md:hidden`) venue cards in `src/components/pages/VenuesPage.tsx` to be narrow-screen friendly: compact header (name/address truncated + status badge), 3 key metrics, a group_count row, and a 2x2 action button grid to prevent horizontal overflow. Removed the duplicate "添加分组" button (kept a single entry point).
- 2026-01-22 22:15:00 +0800: Implemented a 400ms debounced search apply in `src/components/pages/VenuesPage.tsx` using `setTimeout` + cleanup, so typing updates `searchInput` without fetching per keystroke; the debounced apply trims input and resets to page 1 while keeping Enter/Search button immediate.
- 2026-01-22 21:15:00 +0800: Refined mobile cards further: switched actions to `flex-wrap` for better density (5 buttons including "Add Group"), and merged group count into a 2x2 metrics grid for consistent layout.
- 2026-01-22: Manual QA (Playwright) against `http://device.m.minitap.org:3010/venues/` verified desktop table vs mobile layout, KPI skeleton/fallback, and search interactions. API requests to `http://device.m.minitap.org/api/v1/...` failed in this environment (cross-origin port mismatch), but error states/rendering paths behaved correctly. Screenshots saved under `/var/folders/p4/fz88wmwj24vdfr6_rwhx7_r40000gn/T/playwright-mcp-output/`.
- 2026-01-22: Added delete-empty-page pagination fallback in `src/components/pages/VenuesPage.tsx`: if deleting the last item on a non-first page, decrement `currentPage` and let the `useEffect(fetchPlaceList)` refetch the previous page while refreshing stats without double-fetching the list.
- 2026-01-22 21:02:08 +0800: Implemented an on-demand groups view in `src/components/pages/VenuesPage.tsx`: clicking `group_count` opens a lightweight Dialog that fetches `groupApi.getList(placeId)` only when opened (race-safe via request id), and renders loading skeletons, an inline error + retry, and an empty state ("暂无分组"). Mobile group count is now a non-overflowing link-style trigger to open the same dialog.
